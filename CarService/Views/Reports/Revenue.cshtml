@using CarService.Services.Interfaces
@model IEnumerable<MonthlyRevenueDto>
@{
    ViewData["Title"] = "Revenue Report";
    var year = (int)ViewBag.Year;
}

<h1><i class="bi bi-graph-up"></i> Revenue Report</h1>
<hr />

<div class="mb-4">
    <form method="get" class="row g-3 align-items-end">
        <div class="col-auto">
            <label for="year" class="form-label">Select Year</label>
            <select name="year" id="year" class="form-select" onchange="this.form.submit()">
                @for (int y = DateTime.UtcNow.Year; y >= DateTime.UtcNow.Year - 5; y--)
                {
                    <option value="@y" selected="@(y == year)">@y</option>
                }
            </select>
        </div>
    </form>
</div>

@if (!Model.Any())
{
    <div class="alert alert-info">No revenue data available for @year.</div>
}
else
{
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-bg-success">
                <div class="card-body text-center">
                    <h6>Total Revenue (@year)</h6>
                    <h3>@Model.Sum(m => m.Revenue).ToString("C")</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-bg-primary">
                <div class="card-body text-center">
                    <h6>Total Orders (@year)</h6>
                    <h3>@Model.Sum(m => m.OrderCount)</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-bg-info">
                <div class="card-body text-center">
                    <h6>Average per Order</h6>
                    <h3>
                        @if (Model.Sum(m => m.OrderCount) > 0)
                        {
                            @((Model.Sum(m => m.Revenue) / Model.Sum(m => m.OrderCount)).ToString("C"))
                        }
                        else
                        {
                            @("$0.00")
                        }
                    </h3>
                </div>
            </div>
        </div>
    </div>

    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Month</th>
                <th class="text-end">Revenue</th>
                <th class="text-end">Order Count</th>
                <th class="text-end">Avg per Order</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.MonthName</td>
                    <td class="text-end">@item.Revenue.ToString("C")</td>
                    <td class="text-end">@item.OrderCount</td>
                    <td class="text-end">
                        @if (item.OrderCount > 0)
                        {
                            @((item.Revenue / item.OrderCount).ToString("C"))
                        }
                        else
                        {
                            @("$0.00")
                        }
                    </td>
                </tr>
            }
        </tbody>
        <tfoot class="table-light">
            <tr class="fw-bold">
                <td>Total</td>
                <td class="text-end">@Model.Sum(m => m.Revenue).ToString("C")</td>
                <td class="text-end">@Model.Sum(m => m.OrderCount)</td>
                <td class="text-end">
                    @if (Model.Sum(m => m.OrderCount) > 0)
                    {
                        @((Model.Sum(m => m.Revenue) / Model.Sum(m => m.OrderCount)).ToString("C"))
                    }
                    else
                    {
                        @("$0.00")
                    }
                </td>
            </tr>
        </tfoot>
    </table>
}

<partial name="_BackButton" model='"Back to Dashboard"' />
