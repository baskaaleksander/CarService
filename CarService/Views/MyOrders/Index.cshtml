@model IEnumerable<ServiceOrder>
@{
    ViewData["Title"] = "My Orders";
}

<h1>My Orders</h1>

<p>
    <a asp-controller="Appointments" asp-action="Book" class="btn btn-primary">Book New Appointment</a>
</p>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

@if (!Model.Any())
{
    <div class="alert alert-info">You don't have any service orders yet. Book an appointment to get started!</div>
}
else
{
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Order #</th>
                <th>Vehicle</th>
                <th>Status</th>
                <th>Date</th>
                <th>Total Cost</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var order in Model.OrderByDescending(o => o.CreatedAt))
            {
                <tr>
                    <td>#@order.Id</td>
                    <td>@order.Vehicle?.Brand @order.Vehicle?.Model (@order.Vehicle?.RegistrationNumber)</td>
                    <td>
                        @{
                            var statusClass = order.Status switch
                            {
                                CarService.Models.Enums.ServiceOrderStatus.Pending => "bg-warning",
                                CarService.Models.Enums.ServiceOrderStatus.InProgress => "bg-info",
                                CarService.Models.Enums.ServiceOrderStatus.Completed => "bg-success",
                                CarService.Models.Enums.ServiceOrderStatus.Cancelled => "bg-secondary",
                                _ => "bg-secondary"
                            };
                        }
                        <span class="badge @statusClass">@order.Status</span>
                    </td>
                    <td>@order.CreatedAt.ToString("MMM dd, yyyy")</td>
                    <td>@order.Items.Sum(i => i.Quantity * i.UnitPrice).ToString("C")</td>
                    <td>
                        <a asp-action="Details" asp-route-id="@order.Id" class="btn btn-sm btn-info">Details</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
